<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Configuration - BonsaiDb User&#x27;s Guide</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">About BonsaiDb</li><li class="chapter-item expanded "><a href="../about/concepts.html"><strong aria-hidden="true">1.</strong> Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../about/concepts/document.html"><strong aria-hidden="true">1.1.</strong> Document</a></li><li class="chapter-item expanded "><a href="../about/concepts/collection.html"><strong aria-hidden="true">1.2.</strong> Collection</a></li><li class="chapter-item expanded "><a href="../about/concepts/view.html"><strong aria-hidden="true">1.3.</strong> View</a></li><li class="chapter-item expanded "><a href="../about/concepts/schema.html"><strong aria-hidden="true">1.4.</strong> Schema</a></li><li class="chapter-item expanded "><a href="../about/concepts/database.html"><strong aria-hidden="true">1.5.</strong> Database</a></li><li class="chapter-item expanded "><a href="../about/concepts/storage.html"><strong aria-hidden="true">1.6.</strong> Storage</a></li><li class="chapter-item expanded "><a href="../about/concepts/pubsub.html"><strong aria-hidden="true">1.7.</strong> PubSub</a></li></ol></li><li class="chapter-item expanded "><a href="../about/access_models.html"><strong aria-hidden="true">2.</strong> How can BonsaiDb be accessed?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../about/access-models/custom-api-server.html"><strong aria-hidden="true">2.1.</strong> Custom Api Server</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Integration</li><li class="chapter-item expanded "><a href="../integration/overview.html"><strong aria-hidden="true">3.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../integration/local.html"><strong aria-hidden="true">4.</strong> Local</a></li><li class="chapter-item expanded "><a href="../integration/server.html"><strong aria-hidden="true">5.</strong> Networked</a></li><li class="chapter-item expanded "><a href="../integration/cluster.html"><strong aria-hidden="true">6.</strong> Clustered (upcoming)</a></li><li class="chapter-item expanded affix "><li class="part-title">Core Traits</li><li class="chapter-item expanded "><a href="../traits/connection.html"><strong aria-hidden="true">7.</strong> Connection</a></li><li class="chapter-item expanded "><a href="../traits/storage_connection.html"><strong aria-hidden="true">8.</strong> StorageConnection</a></li><li class="chapter-item expanded "><a href="../traits/pubsub.html"><strong aria-hidden="true">9.</strong> PubSub</a></li><li class="chapter-item expanded "><a href="../traits/key-value.html"><strong aria-hidden="true">10.</strong> KeyValue</a></li><li class="chapter-item expanded affix "><li class="part-title">Administration</li><li class="chapter-item expanded "><a href="../administration/configuration.html" class="active"><strong aria-hidden="true">11.</strong> Configuration</a></li><li class="chapter-item expanded "><a href="../administration/permissions.html"><strong aria-hidden="true">12.</strong> Permissions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../administration/permission-statements.html"><strong aria-hidden="true">12.1.</strong> Permission Statements</a></li><li class="chapter-item expanded "><a href="../administration/rbac.html"><strong aria-hidden="true">12.2.</strong> Users, Groups, and Roles</a></li></ol></li><li class="chapter-item expanded "><a href="../administration/encryption.html"><strong aria-hidden="true">13.</strong> At-Rest Encryption</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">BonsaiDb User&#x27;s Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="configuration"><a class="header" href="#configuration">Configuration</a></h1>
<p>BonsaiDb attempts to have reasonable default configuration options, but it's important to browse the available options to ensure there aren't options that might help your particular needs.</p>
<h2 id="storage-configuration"><a class="header" href="#storage-configuration">Storage Configuration</a></h2>
<p>The <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/struct.StorageConfiguration.html"><code>StorageConfiguration</code></a> structure is used to open a local-only database. The <code>ServerConfiguration</code> struct contains <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#structfield.storage">an instance of <code>StorageConfiguration</code></a>, and all configuration optionsl are available on it.</p>
<h3 id="vault-key-storage"><a class="header" href="#vault-key-storage">Vault Key Storage</a></h3>
<p>By default, BonsaiDb sets <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/struct.StorageConfiguration.html#structfield.vault_key_storage"><code>vault_key_storage</code></a> to a file stored within the database folder. This is <strong>incredibly insecure and should not be used outside of testing</strong>.</p>
<p>For secure encryption, it is important to store the vault keys in a location that is separate from the database. If the keys are on the same harware as the database, anyone with access to the disk will be able to decrypt the stored data.</p>
<p>If you have more than one server, you can still use <a href="https://dev.bonsaidb.io/main/bonsaidb/local/vault/struct.LocalVaultKeyStorage.html"><code>LocalVaultKeyStorage</code></a> in conjunction with a mounted network share for reasonable security practices -- assuming the network share itself is properly secured.</p>
<p>If you have an S3-compatible storage service available, you can use <a href="https://dev.bonsaidb.io/main/bonsaidb/keystorage/s3/index.html"><code>bonsaidb::keystorage::s3</code></a> to store the vault keys with that service.</p>
<p>Note that by storing your keys remotely, your BonsaiDb database will not be able to be opened unless the keys are able to be read.</p>
<p>Vault Key Storage can also be set using <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/trait.Builder.html#tymethod.vault_key_storage"><code>Builder::vault_key_storage</code></a>.</p>
<h3 id="default-encryption-key"><a class="header" href="#default-encryption-key">Default Encryption Key</a></h3>
<p>By setting <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/struct.StorageConfiguration.html#structfield.default_encryption_key"><code>default_encryption_key</code></a> to a key, all data will be encrypted when written to the disk.</p>
<p>If <code>default_encryption_key</code> is <code>None</code>, encryption will still be performed for collections that return a key from <a href="https://dev.bonsaidb.io/main/bonsaidb/core/schema/trait.Collection.html#method.encryption_key"><code>Collection::encryption_key()</code></a>.</p>
<p>Can also be set using <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/trait.Builder.html#tymethod.default_encryption_key"><code>Builder::default_encryption_key</code></a>.</p>
<h3 id="tasks-worker-count"><a class="header" href="#tasks-worker-count">Tasks: Worker Count</a></h3>
<p>The <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/struct.Tasks.html#structfield.worker_count"><code>tasks.worker_count</code></a> setting controls the number of worker tasks that are spawned to process background tasks.</p>
<p>Can also be set using <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/trait.Builder.html#tymethod.tasks_worker_count"><code>Builder::tasks_worker_count</code></a>.</p>
<h3 id="views-check-integrity-on-open"><a class="header" href="#views-check-integrity-on-open">Views: Check Integrity on Open</a></h3>
<p>When <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/struct.Views.html#structfield.check_integrity_on_open"><code>views.check_integrity_on_open</code></a> is true, all views in all databases will be checked on startup for integrity. If this value is false, the integrity of the view will not be checked until it is accessed for the first time.</p>
<p>By default, BonsaiDb delays checking a view's integrity until its accessed for the first time. it may, however, be preferred to have a higher startup time to ensure consistent response times once the server is running after a restart of the server.</p>
<p>Can also be set using <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/trait.Builder.html#tymethod.check_view_integrity_on_open"><code>Builder::check_view_integrity_on_open</code></a>.</p>
<h3 id="key-value-persistence"><a class="header" href="#key-value-persistence">Key-Value Persistence</a></h3>
<p>The Key-Value store is designed to be a lightweight, atomic data store that is suitable for caching data, tracking metrics, or other situations where a Collection might be overkill.</p>
<p>By default, BonsaiDb persists Key-Value store changes to disk immediately. For light usage, this will not be noticable, and it ensures that no data will ever be lost.</p>
<p>If you're willing to accept potentially losing recent writes, <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/trait.Builder.html#tymethod.key_value_persistence"><code>key_value_persistence</code></a> can be configured to lazily commit changes to disk. The documentation for <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/struct.KeyValuePersistence.html"><code>KeyValuePersistence</code></a> contains examples as well as an explanation of how the rules are evaluated.</p>
<p>Key-Value Persistence can also be set using <a href="https://dev.bonsaidb.io/main/bonsaidb/local/config/trait.Builder.html#tymethod.key_value_persistence"><code>Builder::key_value_persistence</code></a>.</p>
<h2 id="server-configuration"><a class="header" href="#server-configuration">Server Configuration</a></h2>
<p>The <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html"><code>ServerConfiguration</code></a> structure is used to open a BonsaiDb server. Being built atop the local storage engine, this structure exposes <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#structfield.storage">an instance of <code>StorageConfiguration</code></a>, allowing full customization.</p>
<h3 id="server-name"><a class="header" href="#server-name">Server Name</a></h3>
<p>The <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#structfield.server_name"><code>server_name</code></a> setting is for the primary DNS name of the server. The server's TLS certificate should be valid for the server's name.</p>
<p>When using ACME, this setting controls the primary certificate requested.</p>
<p>Can also be set using <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#method.server_name">a builder-style method</a>.</p>
<h3 id="client-simultaneous-request-limit"><a class="header" href="#client-simultaneous-request-limit">Client Simultaneous Request Limit</a></h3>
<p>BonsaiDb's networking protocols support multiple requests to be sent before any responses have been received, sometimes called pipelining. Without a limit, a single malicious client could send a large number of load-inducing requests and cause reliability of service issues for other clients.</p>
<p>By limiting each connection's maximum ability to a reasonable number, it allows clients to take advantage of pipelining without allowing any one client to saturate the server with requests.</p>
<p>This limit is set using the <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#structfield.client_simultaneous_request_limit">client_simultaneous_request_limit</a> field or <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#method.client_simultaneous_request_limit">builder-style method</a>.</p>
<h3 id="request-worker-count"><a class="header" href="#request-worker-count">Request Worker Count</a></h3>
<p>The <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#structfield.request_workers"><code>request_workers</code></a> configuration controls the number of worker tasks that process incoming requests from connected clients. It can also be set via a <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#method.request_workers">builder-style method</a>.</p>
<h3 id="default-permissions-and-authenticated-permissions"><a class="header" href="#default-permissions-and-authenticated-permissions">Default Permissions and Authenticated Permissions</a></h3>
<p>When first connecting to a server, the client is unauthenticated and is granted the permissions defined by <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#structfield.default_permissions"><code>default_permissions</code></a>. Once a connected client has authenticated, the client will be granted <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#structfield.authenticated_permissions"><code>authenticated_permissions</code></a> in addition to whatever permissions already granted by the authenticated role.</p>
<p>By default, both <code>default_permissions</code> and <code>authenticated_permissions</code> contain no granted permissions. This means that by default, no connections are allowed to a server, as the connection hasn't been gramted <a href="https://dev.bonsaidb.io/main/bonsaidb/core/permissions/bonsai/enum.BonsaiAction.html#variant.Server"><code>BonsaiAction::Server(</code></a><a href="https://dev.bonsaidb.io/main/bonsaidb/core/permissions/bonsai/enum.ServerAction.html#variant.Connect"><code>ServerAction::Connect() )</code></a>.</p>
<h3 id="acme-configuration-letsencrypt"><a class="header" href="#acme-configuration-letsencrypt">ACME Configuration (LetsEncrypt)</a></h3>
<p>ACME has two configurable options, a contact email and the ACME directory.</p>
<h4 id="acme-contact-email"><a class="header" href="#acme-contact-email">ACME Contact Email</a></h4>
<p>The contact email is submitted to the ACME directory as part of requesting a TLS certificate. It is optional for the LetsEncrypt directories.</p>
<p>A valid value for this field begins with <code>mailto:</code>.</p>
<p>The contact email can be set using <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.AcmeConfiguration.html#structfield.contact_email"><code>acme.contact_email</code></a> or the <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#method.acme_contact_email">builder-style method</a>.</p>
<h4 id="acme-directory"><a class="header" href="#acme-directory">ACME Directory</a></h4>
<p>By default, BonsaiDb uses the <a href="https://dev.bonsaidb.io/main/bonsaidb/server/constant.LETS_ENCRYPT_PRODUCTION_DIRECTORY.html">production LetsEncrypt directory</a>, but any ACME directory can be specified.</p>
<p>The directory can be set using <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.AcmeConfiguration.html#structfield.directory"><code>acme.directory</code></a> or the <a href="https://dev.bonsaidb.io/main/bonsaidb/server/struct.ServerConfiguration.html#method.acme_directory">builder-style method</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../traits/key-value.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../administration/permissions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../traits/key-value.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../administration/permissions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>
