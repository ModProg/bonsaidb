<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Encryption and secret management."><meta name="keywords" content="rust, rustlang, rust-lang, vault"><title>bonsaidb::local::vault - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../../ayu.css" disabled ><script id="default-settings" ></script><script src="../../../storage.js"></script><script src="../../../crates.js"></script><script defer src="../../../main.js"></script>
    <noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../../favicon.svg"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu" role="button">&#9776;</div><a href='../../../bonsaidb/index.html'><div class='logo-container rust-logo'><img src='../../../rust-logo.png' alt='logo'></div></a><h2 class="location">Module vault</h2><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></div><div id="sidebar-vars" data-name="vault" data-ty="mod" data-relpath="./"></div><script defer src="./sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="18" height="18" alt="Pick another theme!" src="../../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../../settings.html" title="settings"><img width="18" height="18" alt="Change settings" src="../../../wheel.svg"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="in-band">Module <a href="../../index.html">bonsaidb</a>::<wbr><a href="../index.html">local</a>::<wbr><a class="mod" href="#">vault</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../../../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../../src/bonsaidb_local/lib.rs.html#31" title="goto source code">[src]</a></span></h1><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Encryption and secret management.</p>
<p><code>BonsaiDb</code>’s vault is the core of encryption and secret management. To offer
this security, <code>BonsaiDb</code> relies on external <a href="trait.VaultKeyStorage.html" title="VaultKeyStorage"><code>VaultKeyStorage</code></a> to provide
the key needed to decrypt the master keys. After the master keys have been
decrypted, the vault is able to function without <a href="trait.VaultKeyStorage.html" title="VaultKeyStorage"><code>VaultKeyStorage</code></a>. This
design ensures that if a copy of a database was stolen, the data that is
stored at-rest cannot be decrypted without gaining access to
<a href="trait.VaultKeyStorage.html" title="VaultKeyStorage"><code>VaultKeyStorage</code></a>.</p>
<h3 id="at-rest-encryption" class="section-header"><a href="#at-rest-encryption">At-Rest Encryption</a></h3>
<p>At-rest encryption only ensures that if the database files are stolen that
an attacker cannot access the data without the encryption key. <code>BonsaiDb</code>
will regularly decrypt data to process it, and while the data is in-memory,
it is subject to the security of the machine running it. If using <code>BonsaiDb</code>
over a network, the network transport layer’s encryption is what ensures
your data’s safety.</p>
<h3 id="security-best-practices" class="section-header"><a href="#security-best-practices">Security Best Practices</a></h3><h4 id="vault-key-storage" class="section-header"><a href="#vault-key-storage">Vault Key Storage</a></h4>
<p>In most situations, do not use <a href="struct.LocalVaultKeyStorage.html" title="LocalVaultKeyStorage"><code>LocalVaultKeyStorage</code></a> in a production
environment. If you store the vault keys on the same disk as the database,
it’s similar to hiding a key to your house under your doormat. It might stop
the casual person from entering your house, but give any attacker a few
minutes, and they’ll find the key.</p>
<p>Instead, you should use a storage location that provides authentication and
encryption. Our recommendation for production enviroments is to find an
Amazon S3-compatible storage service and use
<a href="https://dev.bonsaidb.io/main/bonsaidb_keystorage_s3/struct.S3VaultKeyStorage.html"><code>S3VaultKeyStorage</code></a>.
Eventually, other <code>BonsaiDb</code> servers will be able to operate as key storage
for each other.</p>
<h3 id="encryption-algorithms-used" class="section-header"><a href="#encryption-algorithms-used">Encryption Algorithms Used</a></h3>
<p><code>BonsaiDb</code> uses the <a href="https://github.com/rozbb/rust-hpke"><code>hpke</code></a> crate to
provide Hybrid Public Key Encryption (HPKE) when public key encryption is
being used. This is currently only utilized for encrypting the master keys
with the vault key. Our HPKE uses <code>X25519+HKDF-SHA256+ChaCha20Poly1305</code>.
Long term, we plan to offer public key encryption APIs on top of these same
choices.</p>
<p>For at-rest data encryption, the <a href="https://github.com/RustCrypto/AEADs"><code>AEAD</code>
<code>XChaCha20Poly1305</code></a> implementation is
used directly. This variant of <code>ChaCha20Poly1305</code> extends the nonce from 12
bytes to 24 bytes, which allows for random nonces to be used.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.LocalVaultKeyStorage.html" title="bonsaidb::local::vault::LocalVaultKeyStorage struct">LocalVaultKeyStorage</a></div><div class="item-right docblock-short"><p>Stores vault key locally on disk. This is in general considered insecure,
and shouldn’t be used without careful consideration.</p>
</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="bonsaidb::local::vault::Error enum">Error</a></div><div class="item-right docblock-short"><p>Errors relating to encryption and/or secret storage.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.LocalVaultKeyStorageError.html" title="bonsaidb::local::vault::LocalVaultKeyStorageError enum">LocalVaultKeyStorageError</a></div><div class="item-right docblock-short"><p>Errors from local vault key storage.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.PrivateKey.html" title="bonsaidb::local::vault::PrivateKey enum">PrivateKey</a></div><div class="item-right docblock-short"><p>A private encryption key.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.PublicKey.html" title="bonsaidb::local::vault::PublicKey enum">PublicKey</a></div><div class="item-right docblock-short"><p>A public key corresponding to a <a href="enum.PrivateKey.html" title="PrivateKey"><code>PrivateKey</code></a>.</p>
</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.AnyVaultKeyStorage.html" title="bonsaidb::local::vault::AnyVaultKeyStorage trait">AnyVaultKeyStorage</a></div><div class="item-right docblock-short"><p>A <a href="trait.VaultKeyStorage.html" title="VaultKeyStorage"><code>VaultKeyStorage</code></a> trait that wraps the Error type before returning. This
type is used to allow the Vault to operate without any generic parameters.
This trait is auto-implemented for all <a href="trait.VaultKeyStorage.html" title="VaultKeyStorage"><code>VaultKeyStorage</code></a> implementors.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.VaultKeyStorage.html" title="bonsaidb::local::vault::VaultKeyStorage trait">VaultKeyStorage</a></div><div class="item-right docblock-short"><p>Stores encrypted keys for a vault.</p>
</div></div></div></section><section id="search" class="content hidden"></section><div id="rustdoc-vars" data-root-path="../../../" data-current-crate="bonsaidb" data-search-index-js="../../../search-index.js" data-search-js="../../../search.js"></div>
</body></html>